<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Opensim-dev] .net serialization of SOGs
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/opensim-dev/2010-October/index.html" >
   <LINK REL="made" HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20.net%20serialization%20of%20SOGs&In-Reply-To=%3CAANLkTintYtffkSOEb91HvX6dKRtu0zU_8orXZS5NCQV%2B%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009639.html">
   <LINK REL="Next"  HREF="009624.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Opensim-dev] .net serialization of SOGs</H1>
    <B>Mikko Pallari</B> 
    <A HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20.net%20serialization%20of%20SOGs&In-Reply-To=%3CAANLkTintYtffkSOEb91HvX6dKRtu0zU_8orXZS5NCQV%2B%40mail.gmail.com%3E"
       TITLE="[Opensim-dev] .net serialization of SOGs">mikko.pallari at evocativi.com
       </A><BR>
    <I>Mon Oct 18 11:51:44 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009639.html">[Opensim-dev] .net serialization of SOGs
</A></li>
        <LI>Next message: <A HREF="009624.html">[Opensim-dev] where would I find instructions for upgrading standalone form 0.6.9 to 0.7.x?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9662">[ date ]</a>
              <a href="thread.html#9662">[ thread ]</a>
              <a href="subject.html#9662">[ subject ]</a>
              <a href="author.html#9662">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Oct 11, 2010 at 10:40 AM, Toni Alatalo &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">antont at kyperjokki.fi</A>&gt; wrote:

&gt;<i> On su, 2010-10-10 at 17:06 -0700, <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">diva at metaverseink.com</A> wrote:
</I>&gt;<i> &gt; Adam ping!
</I>&gt;<i> &gt; How's the SOG/SOP refactor coming along? This is coming very close to
</I>&gt;<i> &gt; the need for the refactoring...
</I>&gt;<i>
</I>&gt;<i> Yes, as I think was even written in the refactor plan, a goal there was
</I>&gt;<i> to get Collada save&amp;load support. So that the scene code is first
</I>&gt;<i> refactored to use components, and then a new serialization system made
</I>&gt;<i> that can do many formats. First .net serialization, but then Collada
</I>&gt;<i> too.
</I>&gt;<i>
</I>&gt;<i> All I know is that Adam has put the very first steps to the soprefactor
</I>&gt;<i> branch, a little addition that allows to store arbitrary data in
</I>&gt;<i> components in a map attached to prims. The refactor is not done, the
</I>&gt;<i> hardcoded prim data is still there etc. like before. With the refactor
</I>&gt;<i> the idea is that all data would be in smaller components, for example
</I>&gt;<i> the prim shape data is in an (optional) prim component etc. It seems
</I>&gt;<i> that Adam is so be busy with other things, that if we want the refactor
</I>&gt;<i> implemented someone else should probably step up and do it.
</I>&gt;<i>
</I>&gt;<i> About the formats, yes, something that is not an autogenerated dump of
</I>&gt;<i> the internal code structures that AFAIK every dev wishes that would be
</I>&gt;<i> changed (sog/sop) would be good. A year ago I almost started
</I>&gt;<i> implementing OAR read&amp;write support to Blender, but then when actually
</I>&gt;<i> looked at the &quot;format&quot; decided otherwise and looked at the Collada scene
</I>&gt;<i> spec which seemed quite sane. We've since ended up using Ogre .scene
</I>&gt;<i> files 'cause it was most straightforward for now (dead simple xml scene
</I>&gt;<i> tree, <A HREF="http://www.ogre3d.org/tikiwiki/DotScene">http://www.ogre3d.org/tikiwiki/DotScene</A>).
</I>&gt;<i>
</I>&gt;<i> One suggestion from the talk we had on irc on #opensim-dev now:
</I>&gt;<i> &lt; k\o\w&gt; are you using collada to wrap entire scenes or for individual
</I>&gt;<i> meshes?
</I>&gt;<i> &lt; antont&gt; entire scenes
</I>&gt;<i> &lt; k\o\w&gt; I agree that OAR encapsulation should be replaced with collada
</I>&gt;<i> &lt; k\o\w&gt; but that the contained prim data still needs a saner format
</I>&gt;<i> like HPA
</I>&gt;<i> 09:49 &lt; antont&gt; k\o\w: agreed
</I>&gt;<i>
</I>&gt;<i> We are currently using Collada only when testing WebGL rendering, by
</I>&gt;<i> exporting old scenes from Blender that we've previously exported to
</I>&gt;<i> opensim+modrex using Ogre .scene and .mesh etc, to Collada .dae that
</I>&gt;<i> GLGE can load. But that is giving some more experience with the format
</I>&gt;<i> at least, and so far seems good. Of course it is not suitable out of the
</I>&gt;<i> box for OAR like usage where we need all the opensim specific bits, like
</I>&gt;<i> permissions etc. So perhaps Collada is for import&amp;export, not for backup
</I>&gt;<i> and internal things. Unless OAR would be an extension to it somehow, the
</I>&gt;<i> x is for extensible after all :) . So I guess your plan to do continue
</I>&gt;<i> with the .net xml format but with more control is good.
</I>&gt;<i>
</I>&gt;<i> I'm now about to diverge from your original question and the exact task
</I>&gt;<i> at hand, but perhaps it is helpful to explain a bit what we've done now
</I>&gt;<i> with scene formats and storing data to opensim to know what kind of
</I>&gt;<i> requirements and solutions there are around:
</I>&gt;<i>
</I>&gt;<i> The goal that we have had for which would need the sog/sop refactor,
</I>&gt;<i> allowing storage of arbitrary data in scenes, we've implemented in
</I>&gt;<i> ModRex as a temporary measure so that the client development has been
</I>&gt;<i> able to continue.
</I>&gt;<i>
</I>&gt;<i> The first solution made in March reused an old rex thing that had been
</I>&gt;<i> there forever, RexFreeData, which allowed storing max 1024 chars of text
</I>&gt;<i> attached to an object (to give params to scripts and for them to store
</I>&gt;<i> vals etc). That first impl, used in Naali 0.2 &amp; 0.3 series, just stores
</I>&gt;<i> custom scene entity data as xml in that field and that works also
</I>&gt;<i> against the old pre-naali&amp;taiga realxtend servers 'cause that freedata
</I>&gt;<i> mechanism was there already. But it is limited to that 1024 bytes
</I>&gt;<i> ('cause uses a single generic message for synching all data for an
</I>&gt;<i> entity, and in lludp messages are max 1024 long).
</I>&gt;<i>
</I>&gt;<i> Now, out since last week, there is a new implemention for custom scene
</I>&gt;<i> data storage in modrex. It has tables for entities, components and
</I>&gt;<i> attributes and new messages for doing per-attribute synchronization etc.
</I>&gt;<i> This is out in Taiga 0.2.0 rc1, but not implemented in Naali yet (I
</I>&gt;<i> guess the guys do the client side soon now?). Because it does per-attr
</I>&gt;<i> sync, I think is limited at 1024 for the size of an individual attr, but
</I>&gt;<i> doesn't have a limit for the aggregated size of all attributes of all
</I>&gt;<i> components that are attached to an entity. So should work for pretty
</I>&gt;<i> much everything.
</I>&gt;<i>
</I>
Small correction in here. We have new table only for component data, not for
entities or attributes. And we have messages for synchronization of
individual components, not attributes. As said, these have now been
implemented in ModreX only, but will be implemented in Naali soonish. The
size of the component is only limited by the maximum capacity of the udp
generic message.

Cheers,
Mikko


&gt;<i>
</I>&gt;<i> We hope that this kind of functionality becomes supported by Opensim
</I>&gt;<i> core so that also the data of other applications, and not only the data
</I>&gt;<i> specified by the Second Life (tm) application, gets stored in OARs and
</I>&gt;<i> works when rezzing things from inventory etc. And here the application
</I>&gt;<i> does not mean some realXtend impl, but what *you* or any user defines as
</I>&gt;<i> the components &amp; attributes of your application. For example, I have a
</I>&gt;<i> minimal test component 'Door' with two boolean attributes: opened/closed
</I>&gt;<i> &amp; locked/unlocked. That works on the platform, but the platform doesn't
</I>&gt;<i> need to know anything about doors (in fact is not allowed to know, but
</I>&gt;<i> has to be generic and allow any kind of data).
</I>&gt;<i>
</I>&gt;<i> In the spirit of what Melanie wrote about LLUDP independence, we have
</I>&gt;<i> now also an experimental branch (called Tundra) which doesn't depend on
</I>&gt;<i> LLUDP but uses another protocol (kNet, eNet like) for comms and the
</I>&gt;<i> generic Entity-Component attribute sync *exclusively* for all data. For
</I>&gt;<i> storage it uses a generic mechanism that serializes all
</I>&gt;<i> entity-components with their attribute values, either as xml or to a
</I>&gt;<i> binary file or to a db. That's why the EC mechanism has to be used to
</I>&gt;<i> all data, otherwise it doesn't get stored :)
</I>&gt;<i>
</I>&gt;<i> That is now developed against a server module written for Naali itself
</I>&gt;<i> (in that same Tundra branch on github), but the idea is that if the
</I>&gt;<i> protocol and the approach in general proves useful, but the simple
</I>&gt;<i> server misses features that Opensim has and people need, the same
</I>&gt;<i> protocol could then be implemented as a ClientStack + View to Opensim
</I>&gt;<i> too. The experiment is becoming operational now and hopefully works for
</I>&gt;<i> some basics within a month or so, so we'll know more soon'ish.
</I>&gt;<i>
</I>&gt;<i> 2cently yours,
</I>&gt;<i> ~Toni
</I>&gt;<i>
</I>&gt;<i> &gt; On 10/10/2010 4:45 PM, Justin Clark-Casey wrote:
</I>&gt;<i> &gt; &gt; On 09/10/10 19:05, <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">diva at metaverseink.com</A> wrote:
</I>&gt;<i> &gt; &gt;&gt; Dear devs,
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; I'm pulling my hair here with the serialization of scene objects. This
</I>&gt;<i> &gt; &gt;&gt; is horrible! Using .Net serialization for something as important as
</I>&gt;<i> this
</I>&gt;<i> &gt; &gt;&gt; is the worst idea ever. We're completely frozen. I'm trying to add an
</I>&gt;<i> &gt; &gt;&gt; additional field for the creator info, and I'm stuck in all sorts of
</I>&gt;<i> &gt; &gt;&gt; ways: I can't compute the value of that field at serialization-time,
</I>&gt;<i> and
</I>&gt;<i> &gt; &gt;&gt; then there are the issues of compatibility with previous versions of
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt;&gt; SOP class.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; I'd like to understand all the implications of doing an entirely
</I>&gt;<i> &gt; &gt;&gt; different serialization procedure, one that does not use reflection,
</I>&gt;<i> and
</I>&gt;<i> &gt; &gt;&gt; that allows for processing-during-serialization. What will break, and
</I>&gt;<i> &gt; &gt;&gt; therefore needs fixing?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Grovelling back through the archives, I found the e-mail where I
</I>&gt;<i> &gt; &gt; proposed this very thing back in June 2009!
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.berlios.de/pipermail/opensim-dev/2009-June/006805.html">https://lists.berlios.de/pipermail/opensim-dev/2009-June/006805.html</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; And here's the old patch which partially implemented write.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.berlios.de/pipermail/opensim-dev/2009-July/006954.html">https://lists.berlios.de/pipermail/opensim-dev/2009-July/006954.html</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; As you wrote later, some equivalent code was later put in libOMV,
</I>&gt;<i> though
</I>&gt;<i> &gt; &gt; I would test it carefully (at the time I vaguely recall thinking that
</I>&gt;<i> it
</I>&gt;<i> &gt; &gt; didn't deal with some serialization cases, but this may well have been
</I>&gt;<i> &gt; &gt; addressed).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I'm not excited about whether this code remains in libOMV or is placed
</I>&gt;<i> &gt; &gt; in OpenSim if it's going to act as a legacy format in some way.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; As far as I recall, there are no implications of doing this manually as
</I>&gt;<i> &gt; &gt; long as the XML ends up being the same.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; I understand all archiving related to previous versions will break, so
</I>&gt;<i> &gt; &gt;&gt; we need to keep supporting the existing serialization 'disease' for
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt;&gt; foreseeable future. I also understand that TPs/crossings between sims
</I>&gt;<i> &gt; &gt;&gt; that talk different SOG serializations will break, but that's not so
</I>&gt;<i> bad.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; If the SOG serialization is going to change in an incompatible manner,
</I>&gt;<i> I
</I>&gt;<i> &gt; &gt; absolutely need to bump the OAR/IAR version numbers at the same time in
</I>&gt;<i> &gt; &gt; order to maintain confidence in the archiving. I also need to write the
</I>&gt;<i> &gt; &gt; code to stop old OpenSims trying to load these new versions.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Please can we co-ordinate this in a branch?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Anything else I should be aware of before I go off and redo this?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Although .net auto-serialization is fatal if you want to make type
</I>&gt;<i> &gt; &gt; changes to existing fields, it has been very convenient for adding new
</I>&gt;<i> &gt; &gt; fields, since extraneous xml elements are simply ignored on
</I>&gt;<i> &gt; &gt; deserialization. I think it's almost essential that a new format behave
</I>&gt;<i> &gt; &gt; in the same way.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Also, are you going to put version numbers in the new serializations so
</I>&gt;<i> &gt; &gt; that any future incompatible can be dealt with in some manner?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Is it worth considering whether other virtual environments might store
</I>&gt;<i> &gt; &gt; completely different object serializations?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; For any new format, I agree with Dahlia in that something OSD-like may
</I>&gt;<i> &gt; &gt; be worth looking at, perhaps just a simple map as I was considering for
</I>&gt;<i> &gt; &gt; the 'dynamic attributes' in SOP. In fact, this could allow that to fit
</I>&gt;<i> &gt; &gt; in nicely.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Opensim-dev mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">Opensim-dev at lists.berlios.de</A>
</I>&gt;<i> &gt; <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">https://lists.berlios.de/mailman/listinfo/opensim-dev</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Opensim-dev mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">Opensim-dev at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">https://lists.berlios.de/mailman/listinfo/opensim-dev</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/opensim-dev/attachments/20101018/253a153c/attachment.html">https://lists.berlios.de/pipermail/opensim-dev/attachments/20101018/253a153c/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009639.html">[Opensim-dev] .net serialization of SOGs
</A></li>
	<LI>Next message: <A HREF="009624.html">[Opensim-dev] where would I find instructions for upgrading standalone form 0.6.9 to 0.7.x?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9662">[ date ]</a>
              <a href="thread.html#9662">[ thread ]</a>
              <a href="subject.html#9662">[ subject ]</a>
              <a href="author.html#9662">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/opensim-dev">More information about the Opensim-dev
mailing list</a><br>
</body></html>
