<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Opensim-dev] UUID [Was: Proposal to eliminate the name, description and invType fields from the assets db]
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/opensim-dev/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20UUID%20%5BWas%3A%20Proposal%20to%20eliminate%20the%20name%2C%0A%20description%20and%20invType%20fields%20from%20the%20assets%20db%5D&In-Reply-To=%3CBLU134-W12E7C8B2D88ACBD855D861D5A10%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002005.html">
   <LINK REL="Next"  HREF="001990.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Opensim-dev] UUID [Was: Proposal to eliminate the name, description and invType fields from the assets db]</H1>
    <B>Stefan Andersson</B> 
    <A HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20UUID%20%5BWas%3A%20Proposal%20to%20eliminate%20the%20name%2C%0A%20description%20and%20invType%20fields%20from%20the%20assets%20db%5D&In-Reply-To=%3CBLU134-W12E7C8B2D88ACBD855D861D5A10%40phx.gbl%3E"
       TITLE="[Opensim-dev] UUID [Was: Proposal to eliminate the name, description and invType fields from the assets db]">stefan at tribalmedia.se
       </A><BR>
    <I>Tue Jun 24 10:25:45 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002005.html">[Opensim-dev] Proposal to eliminate the name, description and invType fields from the assets db
</A></li>
        <LI>Next message: <A HREF="001990.html">[Opensim-dev] UUID [Was: Proposal to eliminate the name, description and invType fields from the assets db]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1987">[ date ]</a>
              <a href="thread.html#1987">[ thread ]</a>
              <a href="subject.html#1987">[ subject ]</a>
              <a href="author.html#1987">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt; Obviously, you wouldn't trust an assetId generated by an &gt; &gt; untrusted source to represent the asset binary anyway, so quite a lot of &gt; &gt; re-hashing and checking will be done along the way anyway.&gt; &gt; I think that whether there's a trust issue or not depends on where you &gt; calculate the hash. If it's calculated at the asset service then &gt; there's no issue. Provided it's a _trusted_ asset service. If you're fetching assets to your local asset cache from untrusted sources (asset services) then you have to re-calculate the hash (which makes sending it rather meaningless) - otherwise, I can send you whatever binary data and race another source for that key. The scenario with distributed asset sources has already been implemented by us, hence our interest in this matter. &gt; Even if it's calculated externally, then you could &gt; always force a recalculation if there appears to be a hash collision &gt; when an upload is attempted.Unintentional hash collisions aren't my main concern, as they are astronomically small. I'm worried about Intentional hash collisions, and especially in this scenario, just plain id tampering and spoofing across trust boundaries. Now, ok, generating sha-1 collisions is still in the 2^60 operations range (I believe?) so I don't think anybody would throw that much computer power at replacing an asset binary. It's more a matter of principle - we need start thinking in terms of trust boundaries, where we place them, and what that actually entails. Also, I feel I must say that our 'happy days' of alpha coding are over now. It's obvious that we aren't going to be able to do many more big changes to the architecture now that we have god knows how many installations. So if we're going to do this, we might just as well do it right, or be stuck with a broken solution.&gt; I do think that the dupe issue is going to loom larger if we were to get &gt; to an intergrid architecture of federated asset databases with lots of &gt; people loading in material at different points. The number of &gt; duplicates for a popular texture, say, would steadily increase over time &gt; without any realistic way of co-ordinating reaping within the federation.I totally agree. I'm _for_ hashing and de-duping all the way. Hell, I even want us to do id scavenging thru asset parsing. The SL model of not keeping track of assets, is fundamentally flawed. If we can circumvent that by taking some wise decisions, we should. One way to go about it is to have asset references coupled to users and objects. I don't know if you all have thought about that, but we actually control both the vertical AND the horizontal. When somebody create an asset, we can couple that to that user. (not just as 'creator', but as a reference) When somebody drags it into/onto an object, or changes a texture, we can make a note of that (couple all referenced assets to that object - or remove it if it's removed) We can then declare 'there are no global assets' only what the objects explicitly reference, or what someone has explicitly in his inventory. Hell, in that scenario we could even say 'you can't reference an asset you, or an object of yours, do not have a reference to' - which will probably make SL-molded content producers wet their pants. Of course, this will be a problem when importing assets from other non-OpenSim sources, but hey, that's a problem in itself anyway (as discussed below)&gt; I know flexibility is our watchword, but I wonder if this isn't one &gt; design point where making efforts to be as bendy as possible isn't too &gt; costly in terms of adding extra layers of indirection or passing more &gt; information around a network than is really needed.As Sean was saying - separating the use cases are key. And yes, premature generalization is teh enemy. But just having that extra indirection Asset -&gt; Binary would probably open up for solving several cases. And, as I said, it could even be solved in the database layer, with views.&gt; Another good thing about asset uuid hashes is that they can potentially &gt; make the uuids disappear into the background when integrating with &gt; external programs (and the rest of the web). For instance, suppose that &gt; a user wants to design a complex object or entire scene in some external &gt; program, and periodically upload different versions to their region &gt; server (grid connected or not). If our hashes are random, either the &gt; user or their program has to worry about generating new random ones for &gt; each changed prim in their building/vehicle/elaborate clothing design. &gt; For OpenSim to be reliable we have to assume that they will forget and &gt; attempt to upload changed assets with existing uuids. OpenSim might &gt; then need to drag down large amounts of existing data from the asset &gt; service to run internal hashing to know whether it needs to generate new &gt; uuids or not, or force every single imported prim to have a new uuid &gt; (which will really push up the dupe levels).Which would then give us the problem that the external source has taken the OpenSim id, changed the binary, uploaded it again, OpenSim forces an id change, and your interlinked assets are then corrupted? Or, the id is actually changed, which means that all assets containing a reference to that id (think shirt asset containing a reference to a texture asset) now has a new sha-1 hash id (since it contais the id as text) which has to be propagated to all entities referencing it, which in turn gets new sha-1 hashes? And all this has to happen automagically based on the asset being updated or not?&gt; If asset uuids are hashes, then they can disappear from the user and &gt; program's view. Outside of OpenSim, there is no need to manipulate &gt; uuids in this scenario - collections of objects or scenes can be &gt; structured in any way that the external program pleases. Instead of &gt; getting asset uuids on import, the importing process calculates the &gt; necessary uuids from data, and can ask the asset service whether these &gt; already exist without needing to actually obtain the blobs.I definitively think we need to get away from supplying ids in cross-trust border transfers, that's for sure. (Think sending a save-xml to another region and what that implies in terms of (child) agent-&gt;prim referential integrity) If it means stricting up by keeping better track of things or if it means loosening by hashing, I don't know.&gt; I think that it's possible to experiment with the hashing idea without &gt; requiring the whole system to change. Indeed, because of the very &gt; import scenario outlined above, I may well try using it for importing &gt; object archives. This shouldn't impact the rest of the system since, of &gt; course, the chances of collision are small.+1 on more experimenting, less toolshedding. Again, I would say splitting out the binary parts of assets, introducing a sha-1 binaryId is a non-intrusive, no-brainer first step. /Stefan 
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/opensim-dev/attachments/20080624/16e9b02a/attachment.html">https://lists.berlios.de/pipermail/opensim-dev/attachments/20080624/16e9b02a/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002005.html">[Opensim-dev] Proposal to eliminate the name, description and invType fields from the assets db
</A></li>
	<LI>Next message: <A HREF="001990.html">[Opensim-dev] UUID [Was: Proposal to eliminate the name, description and invType fields from the assets db]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1987">[ date ]</a>
              <a href="thread.html#1987">[ thread ]</a>
              <a href="subject.html#1987">[ subject ]</a>
              <a href="author.html#1987">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/opensim-dev">More information about the Opensim-dev
mailing list</a><br>
</body></html>
