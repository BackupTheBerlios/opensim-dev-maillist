<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Opensim-dev] Yield Prolog ported to OpenSim scripting
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/opensim-dev/2008-May/index.html" >
   <LINK REL="made" HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20Yield%20Prolog%20ported%20to%20OpenSim%20scripting&In-Reply-To=%3C2dc1ad636347810cda1be41c0b5c607e%40daxtron.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001578.html">
   <LINK REL="Next"  HREF="001583.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Opensim-dev] Yield Prolog ported to OpenSim scripting</H1>
    <B>kino at daxtron.com</B> 
    <A HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20Yield%20Prolog%20ported%20to%20OpenSim%20scripting&In-Reply-To=%3C2dc1ad636347810cda1be41c0b5c607e%40daxtron.com%3E"
       TITLE="[Opensim-dev] Yield Prolog ported to OpenSim scripting">kino at daxtron.com
       </A><BR>
    <I>Sun May 18 22:31:20 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001578.html">[Opensim-dev] OT : Procedural Generation Competition
</A></li>
        <LI>Next message: <A HREF="001583.html">[Opensim-dev] OpenSim building on Sun's Niagara platform.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1579">[ date ]</a>
              <a href="thread.html#1579">[ thread ]</a>
              <a href="subject.html#1579">[ subject ]</a>
              <a href="author.html#1579">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I recently submitted a patch for Prolog as a scripting language.
<A HREF="http://opensimulator.org/mantis/view.php?id=1314">http://opensimulator.org/mantis/view.php?id=1314</A>

It uses a //YP section to indicate the prolog code section followed by a //CS section.

The current system is about the power of original Turbo Prolog. It compiles the Prolog into C# that is compatible with the existing C# scripting. It does support dynamic data but not dynamic rules yet. It does support most of the basic functionality of Prolog, being able to do declaritive programming and logic.

Currently Jeff Thompson would like it to keep the &quot;static&quot; declarations which I strip out. However, the compiler can also generates Javascript or Python, each of which are part of the Opensim language set (or will be). So if dynamic rules cannot be supported without a &quot;static&quot; declaration in C# , it could be by generating say Python, without affecting any created scripts.

Below is the core of the Readme.txt file (and the mantis entry). 

I think this might be something that people doing virtual data centers and NPC might be interested in.

Bests,
Kino Coursey
Daxtron Labs


====================================
YPOS: YieldProlog for OpenSim

 a compiler from Prolog to OpenSim compatible C# scripts

Ported by Kino Coursey and Douglas Miles at Daxtron Labs.
Based on Jeff Thompson Yield Prolog,  <A HREF="http://yieldprolog.sourceforge.net/">http://yieldprolog.sourceforge.net/</A>
For Prolog see  <A HREF="http://en.wikipedia.org/wiki/Prolog">http://en.wikipedia.org/wiki/Prolog</A>


INTRODUCTION

This folder contains code to implement a Prolog compiler using the &quot;Yield Statement&quot; found in C#, Javascript, and Python.
The original Yield Prolog system can transform Prolog programs into C# code.
In this system we detect and extract YieldProlog code (with &quot;//YP&quot; as the first four characters in the script) and seperate it from any c# code (&quot;marked by &quot;//CS&quot;).
The YP code is transformed to C# and prepended to the &quot;//CS&quot; section, and passed as a bundel to the existing C# compiler.
The end result is Prolog can interface to OpenSim using the existing &quot;//CS&quot; functionality, and C# can call the compiled Prolog.
As such YP allows both declaritive and procedural programming in a 3D script enabled environment.

FEATURES
* Allows implementation of logic programming for objects and agents.
* C#/Javascript/Python as intermediate language
* Yield Prolog has relatively high speed of execution which is important in OpenSim.  <A HREF="http://yieldprolog.sourceforge.net/benchmarks.html">http://yieldprolog.sourceforge.net/benchmarks.html</A>
* It is compatable with the existing C#/Mono based system.
* Yield Prolog is BSD license
* Calling Prolog from C# scripts
* Calling C# functions (with LSL and OS functions) from Prolog
* Prolog dynamic database
* Edinburgh, Cocksin &amp; Mellish style syntax.
* Compiler is generated by compiling the Prolog descrition of itself into C#
* Same script entry interface as LSL


TODO 
* Utilize ability to generate Javascript and Python code
* Integrate Prolog database with Sim
* Translation error reporting back to the editor
* Communications via message passing
* Interface to external inference engines

POSSIBILITIES
* Inworld expert systems
* Parallel logic programming and expert systems
* Ontology based processing
* Knowledge based alerting, accessing and business rules
   For instance, listen on channel x, filter the events and broadcast alerts on channel y
     or send IM, emails etc.


USAGE:

Add &quot;yp&quot; as an allowed compiler
 
OpenSim.ini 
[ScriptEngine.DotNetEngine]
AllowedCompilers=lsl,cs,js,vb,yp

Enter scripts using the inworld editing process. Scripts have the following format.
The first line of a file must have &quot;//yp&quot;.

//yp
&lt;PROLOG CODE&gt;
//CS
&lt;CS CODE&gt;


C# code calling a Prolog Predicate:
-----------------------------------
The Prolog predicate is transformed into a C# boolean function. So the general calling format is:
	foreach( bool var in  prolog_predicate(ARGS)) {};

I/O is via using a string reader and writer in conjunction with YP.See() and YP.Tell()

            StringWriter PrologOutuput= new StringWriter();
            StringReader PrologInput= new StringReader(myInputString);
            YP.see(PrologInput);
            YP.tell(PrologOutuput);
	    &lt;CALL PROLOG CODE HERE&gt;
	    YP.seen();
	    YP.told();
	    StringBuilder builder = PrologOutput.GetStringBuilder();
	    string finaloutput = builder.ToString();

Any prolog reads and writes will be to the passed StringReader and StringWriter. In fact any TextReader/TextWriter class can be used.

Strings in Prolog are stored as Atom's and you need to use an Atom object to match.

\\yp
wanted('bob').
\\cs
string Who=&quot;bob&quot;;
foreach( bool ans in wanted(Atom.a(Who) )){};


Prolog code calling a C# function:
-----------------------------------
The prolog code uses the script_event('name_of_function',ARGS) builtin, which is transformed into the function call.
The C# function called uses &quot;PrologCallback&quot; and returns a boolean.


Dynamic database assertions:
-----------------------------------

void assertdb2(string predicate, string arg1, string arg2)
{
        name = Atom.a(predicate);
        YP.assertFact(name, new object[] { arg1, arg2 });
}

void retractdb2(string predicate, string arg1, string arg2)
{
        name = Atom.a(predicate);
        YP.retractFact(name, new object[] { arg1, arg2 });
}


========================= APPENDIX A: touch test ================================

 ===================================
Input YP Code
 ===================================
//yp
 mydb('field2','field1').
 mydb('andy','jane').
 mydb('carl','dan').
 mydb('andy','bill').
 mydb('andy','betty').
 
 call_me(X):-mydb(X,Y) , respond(Y).
 respond(X):- script_event('sayit',X).

//cs
  public void default_event_touch_start(int N ) 
  {
      llSay(0,&quot;pstart1&quot;);
      foreach( bool ans in call_me(Atom.a(@&quot;andy&quot;) )){};
      llSay(0,&quot;pstop2&quot;);
  }
  
  public void default_event_state_entry()
  {
     llSay(0,&quot;prolog tester active.&quot;);  
  }

PrologCallback sayit(object ans)
  {
      llSay(0,&quot;sayit1&quot;);
      string msg = &quot;one answer is :&quot;+((Variable)ans).getValue();  
      llSay(0,msg); 
      yield return false;
  }


 
========================= APPENDIX B:SENSOR INFORMED SCRIPT =====================


 ===================================
Input YP Code
 ===================================
//yp

nop.

good('Daxxon Kinoc').
good('Fluffy Kitty').

bad('Eric Evil').
bad('Spikey Plant').

prolog_notify(X) :- good(X) , script_event('accept',X).
prolog_notify(X) :- bad(X) , script_event('reject',X).


//cs

public void default_event_state_entry()
  {
     llSay(0,&quot;prolog sensor tester active.&quot;);

    // Start a sensor looking for Agents
     llSensorRepeat(&quot;&quot;,&quot;&quot;,AGENT, 10, PI,20); 

  }

public void default_event_sensor(int number_detected )
{
  int i;
  for(i=0;i&lt; number_detected ;i++)
   {
    string dName = llDetectedName(i);
    string dOwner = llDetectedName(i);
    foreach(bool response in prolog_notify(Atom.a(dName)) ){};
    foreach(bool response in prolog_notify(dOwner) ){};
    llSay(0,&quot;Saw &quot;+dName);
   }
}

string decodeToString(object obj)
{
    if (obj is Variable) { return (string) ((Variable)obj).getValue();}
    if (obj is Atom) { return (string) ((Atom)obj)._name;}
    return &quot;unknown type&quot;;
}

PrologCallback accept(object ans)
  {
      string msg = &quot;Welcoming :&quot;+decodeToString(ans);  
      llSay(0,msg); 
      yield return false;
  }

PrologCallback reject(object ans)
  {
      string msg = &quot;Watching :&quot;+decodeToString(ans);  
      llSay(0,msg); 
      yield return false;
  }


 

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001578.html">[Opensim-dev] OT : Procedural Generation Competition
</A></li>
	<LI>Next message: <A HREF="001583.html">[Opensim-dev] OpenSim building on Sun's Niagara platform.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1579">[ date ]</a>
              <a href="thread.html#1579">[ thread ]</a>
              <a href="subject.html#1579">[ subject ]</a>
              <a href="author.html#1579">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/opensim-dev">More information about the Opensim-dev
mailing list</a><br>
</body></html>
