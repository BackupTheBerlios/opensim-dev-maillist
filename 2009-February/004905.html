<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Opensim-dev] [Opensim-commits] r8236 - in trunk/OpenSim: ApplicationPlugins/Rest/Inventory Data/MSSQL Data/MySQL Data/NHibernate Data/SQLite Data/Tests Framework Framework/AssetLoader/Filesystem Framework/Communications/Cache Framework/Communications/Capabilities Grid/AssetServer Region/ClientStack/LindenUDP Region/Communications/Hypergrid Region/Environment/Modules/Agent/AssetTransaction Region/Environment/Modules/Agent/TextureSender Region/Environment/Modules/Avatar/Inventory/Archiver Region/Environment/Modules/Scripting/DynamicTexture Region/Environment/Modules/World/Archiver Region/Environment/Modules/World/Estate Region/Environment/Scenes Region/Environment/Scenes/Hypergrid Region/ScriptEngine/Shared/Api/Implementation
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/opensim-dev/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20%5BOpensim-commits%5D%20r8236%20-%20in%20trunk/OpenSim%3A%0A%20ApplicationPlugins/Rest/Inventory%20Data/MSSQL%20Data/MySQL%20Data/NHibernate%0A%20Data/SQLite%20Data/Tests%20Framework%20Framework/AssetLoader/Filesystem%0A%20Framework/Communications/Cache%20Framework/Communications/Capabilities%0A%20Grid/AssetServer%20Region/ClientStack/LindenUDP%0A%20Region/Communications/Hypergrid%0A%20Region/Environment/Modules/Agent/AssetTransaction%0A%20Region/Environment/Modules/Agent/TextureSender%0A%20Region/Environment/Modules/Avatar/Inventory/Archiver%0A%20Region/Environment/Modules/Scripting/DynamicTexture%0A%20Region/Environment/Modules/World/Archiver%0A%20Region/Environment/Modules/World/Estate%20Region/Environment/Scenes%0A%20Region/Environment/Scenes/Hypergrid%0A%20Region/ScriptEngine/Shared/Api/Implementation&In-Reply-To=%3C20090205092706.2cdfa66b%40sumo%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004898.html">
   <LINK REL="Next"  HREF="004901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Opensim-dev] [Opensim-commits] r8236 - in trunk/OpenSim: ApplicationPlugins/Rest/Inventory Data/MSSQL Data/MySQL Data/NHibernate Data/SQLite Data/Tests Framework Framework/AssetLoader/Filesystem Framework/Communications/Cache Framework/Communications/Capabilities Grid/AssetServer Region/ClientStack/LindenUDP Region/Communications/Hypergrid Region/Environment/Modules/Agent/AssetTransaction Region/Environment/Modules/Agent/TextureSender Region/Environment/Modules/Avatar/Inventory/Archiver Region/Environment/Modules/Scripting/DynamicTexture Region/Environment/Modules/World/Archiver Region/Environment/Modules/World/Estate Region/Environment/Scenes Region/Environment/Scenes/Hypergrid Region/ScriptEngine/Shared/Api/Implementation</H1>
    <B>Mike Mazur</B> 
    <A HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20%5BOpensim-commits%5D%20r8236%20-%20in%20trunk/OpenSim%3A%0A%20ApplicationPlugins/Rest/Inventory%20Data/MSSQL%20Data/MySQL%20Data/NHibernate%0A%20Data/SQLite%20Data/Tests%20Framework%20Framework/AssetLoader/Filesystem%0A%20Framework/Communications/Cache%20Framework/Communications/Capabilities%0A%20Grid/AssetServer%20Region/ClientStack/LindenUDP%0A%20Region/Communications/Hypergrid%0A%20Region/Environment/Modules/Agent/AssetTransaction%0A%20Region/Environment/Modules/Agent/TextureSender%0A%20Region/Environment/Modules/Avatar/Inventory/Archiver%0A%20Region/Environment/Modules/Scripting/DynamicTexture%0A%20Region/Environment/Modules/World/Archiver%0A%20Region/Environment/Modules/World/Estate%20Region/Environment/Scenes%0A%20Region/Environment/Scenes/Hypergrid%0A%20Region/ScriptEngine/Shared/Api/Implementation&In-Reply-To=%3C20090205092706.2cdfa66b%40sumo%3E"
       TITLE="[Opensim-dev] [Opensim-commits] r8236 - in trunk/OpenSim: ApplicationPlugins/Rest/Inventory Data/MSSQL Data/MySQL Data/NHibernate Data/SQLite Data/Tests Framework Framework/AssetLoader/Filesystem Framework/Communications/Cache Framework/Communications/Capabilities Grid/AssetServer Region/ClientStack/LindenUDP Region/Communications/Hypergrid Region/Environment/Modules/Agent/AssetTransaction Region/Environment/Modules/Agent/TextureSender Region/Environment/Modules/Avatar/Inventory/Archiver Region/Environment/Modules/Scripting/DynamicTexture Region/Environment/Modules/World/Archiver Region/Environment/Modules/World/Estate Region/Environment/Scenes Region/Environment/Scenes/Hypergrid Region/ScriptEngine/Shared/Api/Implementation">mmazur at gmail.com
       </A><BR>
    <I>Thu Feb  5 01:27:06 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004898.html">[Opensim-dev] [Opensim-commits] r8236 - in trunk/OpenSim: ApplicationPlugins/Rest/Inventory Data/MSSQL Data/MySQL Data/NHibernate Data/SQLite Data/Tests Framework Framework/AssetLoader/Filesystem Framework/Communications/Cache Framework/Communications/Capabilities Grid/AssetServer Region/ClientStack/LindenUDP Region/Communications/Hypergrid Region/Environment/Modules/Agent/AssetTransaction Region/Environment/Modules/Agent/TextureSender Region/Environment/Modules/Avatar/Inventory/Archiver Region/Environment/Modules/Scripting/DynamicTexture Region/Environment/Modules/World/Archiver Region/Environment/Modules/World/Estate Region/Environment/Scenes Region/Environment/Scenes/Hypergrid Region/ScriptEngine/Shared/Api/Implementation
</A></li>
        <LI>Next message: <A HREF="004901.html">[Opensim-dev] osFunction Threat levels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4905">[ date ]</a>
              <a href="thread.html#4905">[ thread ]</a>
              <a href="subject.html#4905">[ subject ]</a>
              <a href="author.html#4905">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I hoped this email wouldn't get too long, but I'm not sure I succeeded.
Hopefully it's clear and reads quick.

On Wed, 04 Feb 2009 07:41:03 -0500
Sean Dague &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">sdague at gmail.com</A>&gt; wrote:

&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">mikem at opensimulator.org</A> wrote:
</I>&gt;<i> &gt; Author: mikem
</I>&gt;<i> &gt; Date: 2009-02-03 16:01:36 -0800 (Tue, 03 Feb 2009)
</I>&gt;<i> &gt; New Revision: 8236
</I>&gt;<i> 
</I>&gt;<i> Ok, I'm reading through this patch, and it makes everything far more
</I>&gt;<i> confusing.  Now we are flattening and unflattening between 1 and 2
</I>&gt;<i> objects when we touch xml and the database.
</I>
Which XML are you referring to? Is it the NHibernate AssetBase mapping
XML (OpenSim/Data/NHibernate/Resources/AssetBase.hbm.xml)?

&gt;<i> We need to either decide the Metadata is really seperate, in which
</I>&gt;<i> case it's a 2nd level entity in the database and the xml (i.e. new
</I>&gt;<i> table and nested xml), or it isn't, and we got back.  This midway
</I>&gt;<i> point is madness.
</I>
Currently in the database the assets table contains the following
columns:

- id (primary key)
- data
- name
- description
- assetType
- local
- temporary
- create_time
- access_time

Of these columns, everything except data (and probably id) is actually
metadata that describes the asset. In the database it makes sense to
store all this information in the same table since there's a tight
coupling between the data and its metadata.

In the code the AssetBase class is mapped directly to the assets
database table, with class properties mapping directly to columns (ie:
AssetBase.Name &lt;=&gt; assets.name). In order to retrieve asset metadata
from the database, all information is retrieved, including the
potentially large data. This is undesirable if the application is
simply listing assets, for instance.

My commit introduced an AssetMetadata class which represents all the
columns in the assets table except data. This class can be used when
only the metadata is needed in the application, while the AssetBase
class, which is composed of the AssetMetadata class, can be used when
the asset in its entirety is required.

&gt;<i> 1 object per database table please.  Anything else is insanity for a
</I>&gt;<i> datamodel.
</I>
So yes, there are two classes in the code, and one table in the
database. In this case I think it makes sense and it doesn't make the
datamodel very much more complicated.

The 1 object per database table rule is a good one, but like all rules
it's important to remember there are exceptions.

If we decide to go back to the single AssetBase class to represent an
asset and its metadata, we could represent the asset metadata in the
code with an AssetBase instance with its data field set to null:

  AssetBase asset = new AssetBase();
  asset.FullID = dbresult.ID;
  asset.Name = dbresult.Name;
  asset.Data = null;

I can see the resulting code throughout OpenSim becoming more
complicated, because each use of an AssetBase instance requires a
null-check on the Data property to see whether we have a complete asset
or only its metadata.

Having two DB tables, assets and assetmetada, means retrieving all
information requires a join across two tables. Also, potentially three
classes may be required to represent asset metadata, asset data only,
and asset data and metadata together (I haven't through this through so
there's probably a cleaner way).

Another option I see is for the AssetMetadata class to be defined as a
nested class of the AssetBase class. For example:

  public class AssetBase
  {
    public class Metadata
    {
      public string Name;
      public string Description;
      // etc
    }

    private byte[] _data;
    private Metadata _metadata = new Metadata();

    public string Name
    {
      get { return _metadata.Name; }
      set { _metadata.Name = value; }
    }
    // etc
  }

Then the metadata class could be instantiated alone as well (I think):

  AssetBase.Metadata some_metadata = new AssetBase.Metadata();
  some_metadata.Name = &quot;blah&quot;;

In my opinion the current mapping of two classes to one table is a
reasonable departure from the one-class-one-table rule of thumb.

If the decision is made to stick to this rule, though, then my vote is
to split the assets table into two tables, as I see benefits to
naturally support retrieving asset metadata only.

Thanks,
Mike

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004898.html">[Opensim-dev] [Opensim-commits] r8236 - in trunk/OpenSim: ApplicationPlugins/Rest/Inventory Data/MSSQL Data/MySQL Data/NHibernate Data/SQLite Data/Tests Framework Framework/AssetLoader/Filesystem Framework/Communications/Cache Framework/Communications/Capabilities Grid/AssetServer Region/ClientStack/LindenUDP Region/Communications/Hypergrid Region/Environment/Modules/Agent/AssetTransaction Region/Environment/Modules/Agent/TextureSender Region/Environment/Modules/Avatar/Inventory/Archiver Region/Environment/Modules/Scripting/DynamicTexture Region/Environment/Modules/World/Archiver Region/Environment/Modules/World/Estate Region/Environment/Scenes Region/Environment/Scenes/Hypergrid Region/ScriptEngine/Shared/Api/Implementation
</A></li>
	<LI>Next message: <A HREF="004901.html">[Opensim-dev] osFunction Threat levels
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4905">[ date ]</a>
              <a href="thread.html#4905">[ thread ]</a>
              <a href="subject.html#4905">[ subject ]</a>
              <a href="author.html#4905">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/opensim-dev">More information about the Opensim-dev
mailing list</a><br>
</body></html>
