<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Opensim-dev] Thoughts on performance with a profiler
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/opensim-dev/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20Thoughts%20on%20performance%20with%20a%20profiler&In-Reply-To=%3CBLU134-W63B809F72C2B9D215D63DD5AA0%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005402.html">
   <LINK REL="Next"  HREF="005311.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Opensim-dev] Thoughts on performance with a profiler</H1>
    <B>Stefan Andersson</B> 
    <A HREF="mailto:opensim-dev%40lists.berlios.de?Subject=Re%3A%20%5BOpensim-dev%5D%20Thoughts%20on%20performance%20with%20a%20profiler&In-Reply-To=%3CBLU134-W63B809F72C2B9D215D63DD5AA0%40phx.gbl%3E"
       TITLE="[Opensim-dev] Thoughts on performance with a profiler">stefan at tribalmedia.se
       </A><BR>
    <I>Fri Feb 27 15:07:26 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005402.html">[Opensim-dev] Thoughts on performance with a profiler
</A></li>
        <LI>Next message: <A HREF="005311.html">[Opensim-dev] Prebuild fix: Solutions Folder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5502">[ date ]</a>
              <a href="thread.html#5502">[ thread ]</a>
              <a href="subject.html#5502">[ subject ]</a>
              <a href="author.html#5502">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
* There are quite a lot of things that should be indexed, especially those that lock while searching (which I guess more or less all of them do?) - it's become quite apparent that we have thread contention galore in the system.

* I believe that we should start looking at doing more of 'bulk' operations in the database - working with large linksets is one of those things that are really really unoptimized, for example.

* The mark for update was because we wanted to be able to create interest lists and prioritize packet sending by that. Obviously, we don't do that, but that's why we did that model in the first place. I would argue we want to move deeper into working with interest lists and pulling data instead of starting to saturate queues with stale updates.

* +1 on moving stuff out of heartbeat.

* The copies thing is simply as has been said before, the sequence is different. But of course, the payload could be the same. There could probably have been a 'broadcast' function to take a template packet and send to all clients. John Hurliman would probably be the man to do this right for us.

 

Whatever happened to the 3Di packet pool? Are we using that? Did we do the transition fully?

Best regards,
Stefan Andersson
Tribal Media AB



 


From: <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">adam at deepthink.com.au</A>
To: <A HREF="https://lists.berlios.de/mailman/listinfo/opensim-dev">opensim-dev at lists.berlios.de</A>
Date: Mon, 23 Feb 2009 04:08:34 -0500
Subject: [Opensim-dev] Thoughts on performance with a profiler





Test region: 40,000 prims (or there abouts), running trunk. Testing a combination of factors including idle running, idle running with an avatar, etc.
 
Random notes herein:
-          SceneGraph.Get* methods are generally very wasteful. Lots of them use the /slow/ GetEntities method to build a list of entities before searching them. This is particularly noticeable on the GetGroupByPrim(UUID) method. EntityManager should be having indexes for these frequently accessed items.
-          SQLite processing one-at-a-time is very slow. Inserts should be bulked for performance. I suggest running a &#8216;1500ms&#8217; rule on it.
-          Why, to send a primitive do we need to: - Mark it for updates. &#8211; Crawl through the Entities list for updates &#8211; Send updates to ClientViews, when we could just Send the update directly to viewers (EventManager.TriggerOnPrimUpdated[?])?
-          Why does Scene.Heartbeat/Update do more than just updating frame-dependent things? Eg, why not keep Update to just: Update Physics, Process Scripts[?], etc. Out of it we move: Backup (timer?), Land update (when something happens+ timer?), Terrain backup (main backup thread?)
-          Why build X copies of the same packet for fifteen separate clients? Why not re-use the update packet and change the agent IDs? Maybe some kind of &#8216;PacketMaster&#8217; could be developed for each ClientView type which allows us to do &#8216;bulk&#8217; operations like this.
 
I have a feeling that with a few of these things fixed, performance would increase dramatically.
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/opensim-dev/attachments/20090227/5095542c/attachment.html">https://lists.berlios.de/pipermail/opensim-dev/attachments/20090227/5095542c/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005402.html">[Opensim-dev] Thoughts on performance with a profiler
</A></li>
	<LI>Next message: <A HREF="005311.html">[Opensim-dev] Prebuild fix: Solutions Folder
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5502">[ date ]</a>
              <a href="thread.html#5502">[ thread ]</a>
              <a href="subject.html#5502">[ subject ]</a>
              <a href="author.html#5502">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/opensim-dev">More information about the Opensim-dev
mailing list</a><br>
</body></html>
